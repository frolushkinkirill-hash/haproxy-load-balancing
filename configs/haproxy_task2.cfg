# HAProxy Configuration for Task 2: Weighted Round Robin on Layer 7
global
    daemon

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http_front
    bind *:9001
    mode http
    
    # ACL для домена example.local
    acl host_example hdr(host) -i example.local
    
    # Использовать weighted_backend только для example.local
    use_backend weighted_backend if host_example
    
    # Дефолтный бэкенд для остального трафика
    default_backend default_backend

backend weighted_backend
    mode http
    balance roundrobin
    
    # Серверы с разными весами (2:3:4)
    server server1 127.0.0.1:8883 weight 2
    server server2 127.0.0.1:8884 weight 3
    server server3 127.0.0.1:8885 weight 4

backend default_backend
    mode http
    server default_server 127.0.0.1:8080
